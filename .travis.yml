language: python
python:
  "2.7"
os:
  - linux
notifications:
  email: false
sudo: required
dist: xenial
services:
  - xvfb
addons:
  apt:
    packages:
      - mesa-utils
      - x11-apps
before_script:
  - /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -screen 0 1400x900x24 -ac +extension GLX +render;
  - sleep 3 
deploy:
  provider: releases
  file: ./glxgears.png
  api_key:
    secure: daece993192b010a3baf16bcf3827fcbd8bac3c1
  skip_cleanup: true
script:
  - timeout 5 glxgears &
  - sleep 3
  - xwd -name "glxgears" | convert xwd:- "glxgears.png"
